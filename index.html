<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>School Event Management</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Authentication Page -->
    <div id="authPage" class="auth-container">
        <div class="auth-header">
            <div class="logo">üìÖ</div>
            <h1>School Events</h1>
            <p>Stay updated with campus events</p>
        </div>

        <div id="errorMessage" class="error-message hidden"></div>

        <div class="tab-buttons">
            <button class="tab-btn active" onclick="showTab('login')">Login</button>
            <button class="tab-btn" onclick="showTab('signup')">Sign Up</button>
        </div>

        <!-- Login Form -->
        <div id="loginForm">
            <div class="form-group">
                <label>Email</label>
                <input type="email" id="loginEmail" placeholder="your.email@school.edu">
            </div>
            <div class="form-group">
                <label>Password</label>
                <input type="password" id="loginPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
            </div>
            <button class="btn-primary" onclick="handleLogin()">Login</button>
        </div>

        <!-- Signup Form -->
        <div id="signupForm" class="hidden">
            <div class="form-group">
                <label>Full Name</label>
                <input type="text" id="signupName" placeholder="John Doe">
            </div>
            <div class="form-group">
                <label>Email</label>
                <input type="email" id="signupEmail" placeholder="your.email@school.edu">
            </div>
            <div class="form-group">
                <label>Password</label>
                <input type="password" id="signupPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
            </div>
            <div class="form-group">
                <label>Confirm Password</label>
                <input type="password" id="signupConfirmPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
            </div>
            <button class="btn-primary" onclick="handleSignup()">Create Account</button>
        </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboard" class="dashboard container">
        <div class="navbar">
            <div class="navbar-brand">
                <div class="navbar-logo">üìÖ</div>
                <div class="navbar-info">
                    <h2>School Events</h2>
                    <p id="welcomeMessage">Welcome back!</p>
                </div>
            </div>
            <button class="btn-logout" onclick="handleLogout()">
                <span>üö™</span> Logout
            </button>
        </div>

        <div class="dashboard-header">
            <div>
                <h2>Upcoming Events</h2>
                <p>Stay on top of your academic schedule</p>
            </div>
            <button class="btn-add" onclick="toggleAddEvent()">
                <span>‚ûï</span> Add Event
            </button>
        </div>

        <!-- Add Event Form -->
        <div id="addEventForm" class="add-event-form">
            <h3>Add New Event</h3>
            <div id="formError" class="error-message hidden"></div>
            <div class="form-row">
                <div class="form-group">
                    <label>Event Title *</label>
                    <input type="text" id="eventTitle" placeholder="e.g., Physics Midterm">
                </div>
                <div class="form-group">
                    <label>Event Type *</label>
                    <select id="eventType">
                        <option value="">Select type</option>
                        <option value="exam">Exam</option>
                        <option value="midsem">Midsem</option>
                        <option value="src-week">SRC Week</option>
                        <option value="assignment">Assignment</option>
                        <option value="workshop">Workshop</option>
                        <option value="other">Other</option>
                    </select>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Date *</label>
                    <input type="date" id="eventDate">
                </div>
                <div class="form-group">
                    <label>Time *</label>
                    <input type="time" id="eventTime">
                </div>
            </div>
            <div class="form-group">
                <label>Description</label>
                <textarea id="eventDescription" rows="3" placeholder="Additional details about the event..."></textarea>
            </div>
            <div class="form-buttons">
                <button class="btn-submit" onclick="handleAddEvent()">Add Event</button>
                <button class="btn-cancel" onclick="toggleAddEvent()">Cancel</button>
            </div>
        </div>

        <!-- Events List -->
        <div id="eventsList" class="events-list"></div>

        <!-- Empty State -->
        <div id="emptyState" class="empty-state hidden">
            <div class="empty-state-icon">üìö</div>
            <h3>No Upcoming Events</h3>
            <p>Add your first event to get started!</p>
        </div>
    </div>

    <script>
        // Initialize data structures
        let currentUser = null;
        let users = JSON.parse(localStorage.getItem('schoolUsers')) || [];
        let events = JSON.parse(localStorage.getItem('schoolEvents')) || [];

        // Check if user is already logged in
        window.onload = function() {
            const storedUser = JSON.parse(localStorage.getItem('currentUser'));
            if (storedUser) {
                currentUser = storedUser;
                showDashboard();
            }
        };

        // Tab switching
        function showTab(tab) {
            const loginTab = document.querySelectorAll('.tab-btn')[0];
            const signupTab = document.querySelectorAll('.tab-btn')[1];
            const loginForm = document.getElementById('loginForm');
            const signupForm = document.getElementById('signupForm');
            const errorMessage = document.getElementById('errorMessage');

            errorMessage.classList.add('hidden');

            if (tab === 'login') {
                loginTab.classList.add('active');
                signupTab.classList.remove('active');
                loginForm.classList.remove('hidden');
                signupForm.classList.add('hidden');
            } else {
                signupTab.classList.add('active');
                loginTab.classList.remove('active');
                signupForm.classList.remove('hidden');
                loginForm.classList.add('hidden');
            }
        }

        // Show error message
        function showError(message, elementId = 'errorMessage') {
            const errorElement = document.getElementById(elementId);
            errorElement.textContent = message;
            errorElement.classList.remove('hidden');
        }

        // Hide error message
        function hideError(elementId = 'errorMessage') {
            const errorElement = document.getElementById(elementId);
            errorElement.classList.add('hidden');
        }

        // Handle signup
        function handleSignup() {
            hideError();

            const name = document.getElementById('signupName').value.trim();
            const email = document.getElementById('signupEmail').value.trim();
            const password = document.getElementById('signupPassword').value;
            const confirmPassword = document.getElementById('signupConfirmPassword').value;

            if (!name || !email || !password || !confirmPassword) {
                showError('All fields are required');
                return;
            }

            if (password !== confirmPassword) {
                showError('Passwords do not match');
                return;
            }

            if (users.find(u => u.email === email)) {
                showError('Email already exists');
                return;
            }

            const newUser = {
                id: Date.now(),
                name: name,
                email: email,
                password: password
            };

            users.push(newUser);
            localStorage.setItem('schoolUsers', JSON.stringify(users));

            // Clear form
            document.getElementById('signupName').value = '';
            document.getElementById('signupEmail').value = '';
            document.getElementById('signupPassword').value = '';
            document.getElementById('signupConfirmPassword').value = '';

            // Switch to login tab
            showTab('login');
            showError('Account created successfully! Please login.', 'errorMessage');
            setTimeout(() => hideError(), 3000);
        }

        // Handle login
        function handleLogin() {
            hideError();

            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;

            if (!email || !password) {
                showError('Please enter email and password');
                return;
            }

            const user = users.find(u => u.email === email && u.password === password);

            if (user) {
                currentUser = user;
                localStorage.setItem('currentUser', JSON.stringify(user));
                showDashboard();
            } else {
                showError('Invalid email or password');
            }
        }

        // Handle logout
        function handleLogout() {
            currentUser = null;
            localStorage.removeItem('currentUser');
            document.getElementById('authPage').style.display = 'block';
            document.getElementById('dashboard').classList.remove('active');
            document.getElementById('loginEmail').value = '';
            document.getElementById('loginPassword').value = '';
        }

        // Show dashboard
        function showDashboard() {
            document.getElementById('authPage').style.display = 'none';
            document.getElementById('dashboard').classList.add('active');
            document.getElementById('welcomeMessage').textContent = `Welcome, ${currentUser.name}`;
            displayEvents();
        }

        // Toggle add event form
        function toggleAddEvent() {
            const form = document.getElementById('addEventForm');
            form.classList.toggle('active');
            hideError('formError');
            
            if (!form.classList.contains('active')) {
                // Clear form
                document.getElementById('eventTitle').value = '';
                document.getElementById('eventType').value = '';
                document.getElementById('eventDate').value = '';
                document.getElementById('eventTime').value = '';
                document.getElementById('eventDescription').value = '';
            }
        }

        // Handle add event
        function handleAddEvent() {
            hideError('formError');

            const title = document.getElementById('eventTitle').value.trim();
            const type = document.getElementById('eventType').value;
            const date = document.getElementById('eventDate').value;
            const time = document.getElementById('eventTime').value;
            const description = document.getElementById('eventDescription').value.trim();

            if (!title || !type || !date || !time) {
                showError('Please fill all required fields', 'formError');
                return;
            }

            const newEvent = {
                id: Date.now(),
                title: title,
                type: type,
                date: date,
                time: time,
                description: description,
                createdBy: currentUser.email,
                createdAt: new Date().toISOString()
            };

            events.push(newEvent);
            localStorage.setItem('schoolEvents', JSON.stringify(events));

            toggleAddEvent();
            displayEvents();
        }

        // Delete event
        function deleteEvent(eventId) {
            if (confirm('Are you sure you want to delete this event?')) {
                events = events.filter(e => e.id !== eventId);
                localStorage.setItem('schoolEvents', JSON.stringify(events));
                displayEvents();
            }
        }

        // Get days until event
        function getDaysUntil(date) {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const eventDate = new Date(date);
            eventDate.setHours(0, 0, 0, 0);
            const diffTime = eventDate - today;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            return diffDays;
        }

        // Format date
        function formatDate(dateString) {
            const date = new Date(dateString);
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            return date.toLocaleDateString('en-US', options);
        }

        // Get event type label
        function getEventTypeLabel(type) {
            const labels = {
                'exam': 'Exam',
                'midsem': 'Midsem',
                'src-week': 'SRC Week',
                'assignment': 'Assignment',
                'workshop': 'Workshop',
                'other': 'Other'
            };
            return labels[type] || type;
        }

        // Display events
        function displayEvents() {
            const eventsList = document.getElementById('eventsList');
            const emptyState = document.getElementById('emptyState');

            // Filter and sort upcoming events
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            const upcomingEvents = events
                .filter(event => new Date(event.date) >= today)
                .sort((a, b) => new Date(a.date) - new Date(b.date));

            if (upcomingEvents.length === 0) {
                eventsList.innerHTML = '';
                emptyState.classList.remove('hidden');
                return;
            }

            emptyState.classList.add('hidden');
            
            eventsList.innerHTML = upcomingEvents.map(event => {
                const daysUntil = getDaysUntil(event.date);
                const urgentHTML = daysUntil <= 7 ? `
                    <div class="event-urgent">
                        üîî ${daysUntil === 0 ? 'Today!' : daysUntil === 1 ? 'Tomorrow' : `${daysUntil} days`}
                    </div>
                ` : '';

                return `
                    <div class="event-card ${event.type}">
                        <div class="event-content">
                            <div class="event-badges">
                                <span class="event-type ${event.type}">${getEventTypeLabel(event.type)}</span>
                                ${urgentHTML}
                            </div>
                            <div class="event-title">${event.title}</div>
                            ${event.description ? `<div class="event-description">${event.description}</div>` : ''}
                            <div class="event-details">
                                <div class="event-detail">
                                    üìÖ ${formatDate(event.date)}
                                </div>
                                <div class="event-detail">
                                    üïê ${event.time}
                                </div>
                            </div>
                        </div>
                        <button class="btn-delete" onclick="deleteEvent(${event.id})" title="Delete event">
                            üóëÔ∏è
                        </button>
                    </div>
                `;
            }).join('');
        }

        // Enter key support for login
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('loginPassword').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') handleLogin();
            });
            document.getElementById('signupConfirmPassword').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') handleSignup();
            });
        });
    </script>
</body>
</html>